

<!doctype html>
<html lang="en">
   
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tanafs Report page</title>
    
  

    <!-- Google Material Symbols -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"/>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

    <style>
     
:root {
    --bg: #f2f6fb;
    --accent: #0f65ff; /* primary blue */
    --muted: #9aa6c0;
    --radius: 14px;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
    font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: var(--bg);
    color: #15314b;
    display: flex;
}

  .status {
  padding: 0.25em 0.5em;
  border-radius: 0.75em;
  font-size: 0.8125em;
  font-weight: 500;
}
        .status.normal { background: #eaf9ee; color: #1b8a3d; }
        .status.moderate { background: #fff7e6; color: #e6a100; }
        .status.critical { background: #fdeaea; color: #d32f2f; }




/* -------- Report Section -------- */
#report-box { padding: 0.625em 1.875em; }
.report-title { color:#1f46b6; font-weight:800; font-size:1.5em; }

.report-sheet{
  background:#fff; border:1px solid #e9eef6; border-radius:1.125em;
  padding:1.375em; box-shadow:0 0.0625em 0.1875em rgba(0,0,0,.05);
  width: 75%; 
  margin-left: 11em;
  margin-top: 0em;

}

/* Reprt titel*/
.sheet-heading{
  font-weight:800; color:#2b4a77; font-size:1.25em;
  text-align:center; margin-bottom:1.125em;
}

.info-box{
  border:1px solid #e9eef6;
  border-radius:0.75em;
  padding:0.75em 0.875em;
  background:#f9fbff;
  display:grid;
  grid-template-columns:1fr 1fr 1fr; 
  margin-bottom:1.125em;
  white-space: nowrap; /*to avoid go to next line in created by*/ 
 column-gap: 8em; 
}

.info-row{ display:flex;  align-items:center; }
.info-label{ color:#2b4a77; font-weight:700;  }
.info-value{ color:#2b4a77; font-weight:700; }

/* field for report info*/
.field{ display:flex; gap:0.75em;  margin: 2em 0; align-items:center; }
.field .label{ min-width:13.75em; color:#2b4a77; font-weight:800; }
.field .value{
   background:#fff; border:1px solid #eef1f6; border-radius:0.75em;
  padding:0.75em 0.875em; color:#2b4a77;
}

/* Doctor note*/
.note-label{ margin-top:0.875em; color:#2b4a77; font-weight:800; }
.note-input{
  width:100%; min-height:6.875em; 
  background:#fff; border:1px solid #dfe6ef; border-radius:0.75em;
  padding:0.75em 0.875em; color:#2b4a77; margin-top:0.5em;
}

/* Save button*/
#btn-save{
  margin-top:1.5em; 
  background:linear-gradient(90deg,#0f65ff,#5aa6ff);
  color:#fff;
  border:0;
  padding:0.625em 1em; 
  border-radius:0.75em; 
  font-weight:700; 
  font-size: 0.9375em;
  cursor:pointer;
  display:inline-flex; /* to display the text next to the icon */ 
  align-items:center; 
  gap:0.5em; 
  box-shadow:0 0.5em 1.25em rgba(15,101,255,.14);
  margin-left: 12em;
}

/* Responsive */
@media (max-width: 48em){
  .info-box{ grid-template-columns:1fr; }
  .field{ flex-direction:column; align-items:flex-start; }
  .field .label{ min-width:auto; }
}

/* Recent analyzed waveforms */
.waves-list {
  list-style: none; /*to remove defult syle*/
  display: flex;/*allowing easy control over the direction and alignment of its items.*/
  flex-direction: column;
  gap: 0.625em;
}

.wave-item {
  display: grid;
  grid-template-columns: 1fr auto; /*name and sevariy level*/
  gap: 0.75em;
  align-items: center;
  padding: 0.625em 0.75em;
  border: 1px solid #eef1f6;
  border-radius: 0.75em;
  background: #fff;
}

.wave-item .name {
  align-items: center;
  gap: 0.5em;
  font-weight: 600;
  color: #2b4a77;
}

.wave-item .name .material-symbols-outlined {
  font-size: 1.125em; /*control the size of icon */
}

/*profile button*/
.profile-btn {
  all: unset; 
  cursor: pointer;          /* to remove  defult button desgin*/
  display: inline-block;
}
.profile-btn:focus {
  outline: none;      
}


.wrapper {
  position: relative;
  width: 100%;
  min-height: 100vh; 
 
  overflow: visible;
}

main.main {
  flex: 1;
  display: flex;
  flex-direction: column;
}
img.topimg {
  position: absolute;
  top: -2.4%;
  left: 48%;
  transform: translateX(-50%);
  height: auto;
  width: auto;
  max-width: 90%;
  z-index: 10;
  pointer-events: none;
}

img.logo {
  position: absolute;
  top: 2.5%;
  left: 14%;
  width: clamp(100px, 12vw, 180px);
  height: auto;
  z-index: 20;
  pointer-events: none;
}

.auth-nav {
  position: absolute;
  top: 3.9%;
  right: 16.2%;
  display: flex;
  align-items: center;
  gap: 1.6em;
  z-index: 30;
}

/* روابط القائمة */
.nav-link {
  color: #0876FA;
  font-weight: 600;
  text-decoration: none;
  font-size: 1em;
  transition: all 0.3s ease;
  position: relative;
}
.nav-link::after {
  content: "";
  position: absolute;
  bottom: -4px;
  left: 0;
  width: 0;
  height: 2px;
  background: linear-gradient(90deg, #0876FA, #78C1F5);
  transition: width 0.3s ease;
  border-radius: 2px;
}
.nav-link:hover::after { width: 100%; }
.nav-link:hover { transform: translateY(-2px); color: #055ac0; }


.profile-btn { all: unset; cursor: pointer; display: inline-block; }

/* زر تسجيل الخروج */
.btn-logout {
  background: linear-gradient(90deg, #0f65ff, #5aa6ff);
  color: white;
  padding: 0.5em 0.975em;
  border-radius: 0.75em;
  font-weight: 600;
  border: none;
  box-shadow: 0 0.5em 1.25em rgba(15,101,255,0.14);
  cursor: pointer;
  font-size: 0.875em;
}

.site-footer {
  background: #F6F6F6;
  color: #0b1b2b;
  font-family: 'Montserrat', sans-serif;
  margin-top: 6em; /* مسافة مريحة من المحتوى */
  z-index: 10em;
}

.footer-grid {
  max-width: 75em;
  margin: 0 auto;
  padding: 2.5em 1.25em; /* داخلي موحّد */
  display: grid;
  grid-template-columns: 1.2fr 1fr 1fr;
  gap: 2em; /* مسافات بين الأعمدة */
  align-items: start;
}

/* Brand */
.footer-logo {
  height: 5.5em;
  width: auto;
  display: block;
  margin-left: -3em;
}
.brand-tag {
  margin-top: 0.75em;
  color: #4c5d7a;
  font-size: 0.95em;
}

/* Headings */
.footer-title {
  margin: 0 0 1em 0;
  font-size: 1.05em;
  font-weight: 700;
  letter-spacing: 0.02em;
  color: #0B83FE;
  text-transform: uppercase;
}

/* Social */
.social-list {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  gap: 0.75em;
  align-items: center;
}
.social-list li a {
  display: inline-flex;
  width: auto;   
  height: auto;
  align-items: center;
  justify-content: center;
  border-radius: 0;
  background: none; /* لا خلفية */
  box-shadow: none; /* لا ظل */
  transition: transform 0.2s ease, opacity 0.2s ease;
}
.social-list li a:hover {
  transform: translateY(-0.2em);
  box-shadow: 0 0.6em 1.4em rgba(0, 0, 0, 0.08);
}
.social-list img {
  width: 1.2em;
  height: 1.2em;
}
.social-handle {
  display: block;
  margin-top: 0.6em;
  color: #0B83FE;
  font-size: 0.95em;
}

/* Contact */
.contact-list {
  list-style: none;
  padding: 0;
  margin: 0.25em 0 0 0;
  display: grid;
  gap: 0.6em;
}
.contact-link {
  display: flex;
  align-items: center;
  gap: 0.6em;
  text-decoration: none;
  color: #0B83FE;
  padding: 0.5em 0.6em;
  border-radius: 0.6em;
  transition: background 0.2s ease, transform 0.2s ease;
}
.contact-link:hover {
  background: rgba(255, 255, 255, 0.7);
  transform: translateX(0.2em);
}
.contact-link img {
  width: 1.15em;
  height: 1.15em;
}

/* Bottom bar */
.footer-bar {
  border-top: 0.06em solid rgba(11, 45, 92, 0.12);
  text-align: center;
  padding: 0.9em 1em 1.2em;
}
.legal {
  margin: 0.2em 0;
  color: #4c5d7a;
  font-size: 0.9em;
}
.legal a {
  color: #27466e;
  text-decoration: none;
}
.legal a:hover {
  text-decoration: underline;
}
.legal .dot {
  margin: 0 0.5em;
  color: rgba(11, 45, 92, 0.6);
}
.copy {
  margin: 0.2em 0 0;
  color: #0B83FE;
  font-size: 0.85em;
}
.avatar-icon{
  width:30px; height:30px; display:block;
}  




/* قائمة عامة لعناصر (موجات/تعليقات) */
.item-list, .waves-list { list-style: none; display: flex; flex-direction: column; gap: 0.625em; margin: 0; padding: 0; }

.item, .wave-item {
  display: grid;
  grid-template-columns: 1fr auto; /* نص يسار + يمين شارة/تاريخ */
  gap: 0.75em;
  align-items: center;
  padding: 0.625em 0.75em;
  border: 1px solid #eef1f6;
  border-radius: 0.75em;
  background: #fff;
}

.item .meta, .wave-item .meta {
  display: flex; align-items: center; gap: .5em; color:#2b4a77; font-weight:600;
}

.item .right, .wave-item .right { display:flex; align-items:center; gap:.5em; white-space:nowrap; color:#2b4a77; font-variant-numeric: tabular-nums; }

.item .text {
  grid-column: 1 / -1;  /* يمتد كامل العرض تحت السطر الأول */
  background: #f6f9ff; border: 1px solid rgba(15,101,255,0.12);
  border-radius: 0.5em; padding: 0.6em 0.75em; color:#2b4a77; white-space: pre-wrap;
}

/* استايلات الشارة جاهزة عندك: .status.normal/.moderate/.critical */

/* لتصغير وقت وتاريخ الويف فورم */
.wave-item .date {
  font-size: 0.70em;
  color: #6b7b8f;   /* لون أهدى */
}

/* لتصغير وقت وتاريخ الكومنت */
.comment-item .date {
  font-size: 0.70em;
  color: #6b7b8f;   /* نفس اللون حتى يكون مريح بصرياً */
}

.value { font-weight: strong; }








    </style>



</head>

<body>
<div class="wrapper">

    
    <img class="topimg" src="Images/Group 8.png" alt="img">
    <img class="logo" src="Images/Logo.png" alt="Tanafs Logo">

     <nav class="auth-nav" aria-label="User navigation">
        <a class="nav-link" href="dashboard.php">Dashboard</a>
        <a class="nav-link" href="patients.php">Patients</a>
        <a class="nav-link" href="history2.php">History</a>
        <a href="profile.php" class="profile-btn">
            <div class="profile">
                <img class="avatar-icon" src="images/profile.png" alt="Profile">
            </div>
        </a>

        <form action="Logout.php" method="post" style="display:inline;">
            <button type="submit" class="btn-logout">Logout</button>
        </form>
    </nav>



<!-- MAIN -->
<main class="main">


    <!-- Page Title -->
 <h2 style="color:#0B83FE; font-weight:800; font-size:1.6em;
           margin:160px 0 0px 9.2em;">Report</h2>
   

    <section id="report-box">
  

  <div class="report-sheet">
    <div class="sheet-heading" style="color: #1f46b6">Waveform Analysis Summary Report</div>

    <!--info box-->
    <div class="info-box">
  <div class="info-row">
    <div class="info-label">Patient name:</div>
    <div class="info-value" id="r-patient"></div>
  </div>

  <div class="info-row">
    <div class="info-label">Id:</div>
    <div class="info-value" id="r-id"></div>
  </div>

  <div class="info-row">
    <div class="info-label">Datcreation:</div>
    <div class="info-value" id="r-date"></div>
  </div>

  <div class="info-row">
    <div class="info-label">Gender:</div>
    <div class="info-value" id="r-gender"></div>
  </div>

  <div class="info-row">
    <div class="info-label">Phone number:</div>
    <div class="info-value" id="r-phone"></div>
  </div>

  <div class="info-row">
    <div class="info-label">Date of Birth:</div>
    <div class="info-value" id="r-dob"></div>
  </div>

  <div class="info-row">
    <div class="info-label">Created by:</div>
    <div class="info-value" id="r-created-by"></div>
  </div>

  <div class="info-row">
    <div class="info-label">Professional Role:</div>
    <div class="info-value" id="r-role"></div>
  </div>
</div>


    <!-- field-->
  

   


<div class="field">
  <div class="label">Aِِnalyzed waveforms<br>with sevarity level:</div>
  <div class="value">
    <ul class="waves-list" id="waves-list">
      <li class="wave-item">
        <div class="name">
          <span class="material-symbols-outlined">show_chart</span>
         
        </div>
        <span class="status critical"></span>
      </li>
      
<li class="wave-item">
        <div class="name">
          <span class="material-symbols-outlined">show_chart</span>
         
        </div>
        <span class="status critical"></span>
      </li>
      <li class="wave-item">
        <div class="name">
          <span class="material-symbols-outlined">show_chart</span>
         
        </div>
        <span class="status critical"></span>
      </li>

    </ul>
  </div>
</div>

     <!-- Comments list -->
<div class="field">
  <div class="label">Comments:</div>
  <div class="value">
    <ul class="item-list" id="comments-list"></ul>
  </div>
</div>

 
  

    <!--Doctor note -->
    <div class="note-label">Doctor note</div>
    <textarea class="note-input" id="r-note" placeholder="Write your note here..."></textarea>

   
  </div>
   <button  id="btn-save">
      <span class="material-symbols-outlined">save</span> Save
    </button>
</section>
</main>
<script>
function fmtDate(mysqlTs, locale='en-GB') {
  if (!mysqlTs) return '-';
  const d = new Date(String(mysqlTs).replace(' ', 'T'));
  if (isNaN(d)) return mysqlTs;
  return new Intl.DateTimeFormat(locale, {year:'numeric',month:'2-digit',day:'2-digit', timeZone:'Asia/Riyadh'}).format(d);
}
function fmtTime(mysqlTs, locale='en-GB') {
  if (!mysqlTs) return '-';
  const d = new Date(String(mysqlTs).replace(' ', 'T'));
  if (isNaN(d)) return mysqlTs;
  return new Intl.DateTimeFormat(locale, {hour:'2-digit',minute:'2-digit',hour12:false,timeZone:'Asia/Riyadh'}).format(d);
}
function fmtDateTime(mysqlTs, locale='en-GB'){
  const dt = fmtDate(mysqlTs, locale);
  const tm = fmtTime(mysqlTs, locale);
  return (dt==='-' || tm==='-') ? '-' : `${dt}, ${tm}`;
}
</script>

<script>
function getPidFromURL(){
  const pidStr = new URLSearchParams(location.search).get('pid');
  const n = parseInt(pidStr, 10);
  return Number.isFinite(n) ? n : 0;
}
</script>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  const pid = getPidFromURL();
  if (!pid) { alert("Invalid patient id"); return; }

  const wavesList  = document.getElementById("waves-list");
  const commentsUl = document.getElementById("comments-list");

  const getSeverityClass = (level = "") => {
    const s = String(level).trim().toLowerCase();
    if (s.includes("high") || s.includes("critical")) return "critical";
    if (s.includes("moderate") || s.includes("med"))  return "moderate";
    return "normal";
  };

  try {
    const res  = await fetch(`report.php?pid=${encodeURIComponent(pid)}&_=${Date.now()}`, { cache:'no-store' });
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();
    if (data.status !== 'success') throw new Error('bad payload');

    // تعبئة معلومات الرأس
    document.getElementById("r-patient").textContent  = data.patient ?? "Unknown";
    document.getElementById("r-id").textContent       = data.patientId ?? "-";
    document.getElementById("r-gender").textContent   = data.gender ?? "-";
    document.getElementById("r-phone").textContent    = data.phone ?? "-";
    document.getElementById("r-dob").textContent      = data.dob ? fmtDate(data.dob) : "-";
    document.getElementById("r-created-by").textContent = data.createdBy ?? "System";
    document.getElementById("r-role").textContent     = data.creatorRole ?? "-";
    document.getElementById("r-date").textContent     = fmtDateTime(data.date);

    // الموجات
    if (wavesList) {
      wavesList.innerHTML = "";
      (data.waves || []).forEach(w => {
        const li = document.createElement("li");
        li.className = "wave-item";
        li.innerHTML = `
          <div class="meta">
            <span class="material-symbols-outlined">show_chart</span>
            ${w.anomaly}
          </div>
          <div class="right">
            <span class="status ${getSeverityClass(w.level)}">${w.level || '-'}</span>
            <time datetime="${w.timestamp}" title="${w.timestamp}">${fmtDateTime(w.timestamp)}</time>
          </div>`;
        wavesList.appendChild(li);
      });
    }

    // التعليقات
    if (commentsUl) {
      commentsUl.innerHTML = "";
      (data.comments || []).forEach(c => {
        const li = document.createElement("li");
        li.className = "item";
        li.innerHTML = `
          <div class="meta"><span class="material-symbols-outlined">person</span>${c.by || 'Unknown'}</div>
          <div class="right"><time datetime="${c.timestamp}" title="${c.timestamp}">${fmtDateTime(c.timestamp)}</time></div>
          <div class="text">${(c.text ?? '').replace(/</g,'&lt;').replace(/>/g,'&gt;')}</div>`;
        commentsUl.appendChild(li);
      });
    }

  } catch (e) {
    console.error(e);
    alert("cannot upload the report information");
  }
});
</script>






<footer  id="contact" class="site-footer">
  <div class="footer-grid">

    <div class="footer-col brand">
      <img src="images/logo.png" alt="Tanafs logo" class="footer-logo" />
      <p class="brand-tag">Breathe well, live well</p>
    </div>

    <!-- Social -->
    <nav class="footer-col social" aria-label="Social media">
      <h3 class="footer-title">Social Media</h3>
      <ul class="social-list">
        <li>
          <a href="#" aria-label="Twitter">
            <img src="images/twitter.png" alt="Twitter" />
          </a>
        </li>
        <li>
          <a href="#" aria-label="Instagram">
            <img src="images/instagram.png" alt="Instagram" />
          </a>
        </li>
      </ul>
      <span class="social-handle">@official_Tanafs</span>
    </nav>

    <!-- Contact -->
    <div class="footer-col contact">
      <h3 class="footer-title">Contact Us</h3>
      <ul class="contact-list">
        <li>
          <a href="#" class="contact-link">
            <img src="images/whatsapp.png" alt="WhatsApp" />
            <span>+123 165 788</span>
          </a>
        </li>
        <li>
          <a href="mailto:Appointly@gmail.com" class="contact-link">
            <img src="images/email.png" alt="Email" />
            <span>Tanafs@gmail.com</span>
          </a>
        </li>
      </ul>
    </div>

  </div>

  <div class="footer-bar">
    <p class="legal">
      <a href="#">Terms &amp; Conditions</a>
      <span class="dot">•</span>
      <a href="#">Privacy Policy</a>
    </p>
    <p class="copy">© 2025 Tanafs Company. All rights reserved.</p>
  </div>
</footer>

</div>

</body>
</html>
